function NotaFiscal(){}var bodyh="230px;",bodyhmax="540px",real={style:"currency",currency:"BRL",minimumFractionDigits:2,maximumFractionDigits:2},nfh;$(document).ready(function(){t=$("#nota").DataTable({fixedHeader:{header:!0},info:!1,scrollY:"200px",scrollX:!1,order:1,paging:!1,searching:!1});ebs.SetValorMask(".unit");$(".qtd").mask("###0",{reverse:!0});$(".unit").mask("#.##0,00",{reverse:!0});$(".tot").mask("#.##0,00");UpdateTotal()});NotaFiscal.prototype.ImprimeNotaFiscal=n=>{document.querySelector(".dataTables_scrollBody").style.height="640px",document.querySelector(".dataTables_scrollBody").style.scrollY="640px",window.print(),document.location.href=n};NotaFiscal.prototype.ToggleVisibility=n=>{$("#"+n).css("opacity")==="1"?($("#"+n).css("opacity","0.3"),document.querySelector(".dataTables_scrollBody").style.height=bodyhmax,$("#nfHeader").hide()):($("#"+n).css("opacity","1"),document.querySelector(".dataTables_scrollBody").style.height="220px",$("#nfHeader").show())};NotaFiscal.prototype.HideHeader=()=>{$("#nfHeader").hide(1500)};NotaFiscal.prototype.ShowHeader=()=>{$("#nfHeader").show(1500)};NotaFiscal.prototype.UpdateItemQtd=(n,t,i)=>{$.post("/ContaPrs/NotaFiscalUpdateItemQtd",{nfid:n,line:t,qtd:i},function(){}),UpdateItemTotal(n,t)};NotaFiscal.prototype.UpdateItemDescricao=(n,t,i)=>{$.post("/ContaPrs/NotaFiscalUpdateItemDescricao",{nfid:n,line:t,descricao:i},function(){})};NotaFiscal.prototype.UpdateItemUnitario=(n,t,i)=>{$.post("/ContaPrs/NotaFiscalUpdateItemUnitario",{nfid:n,line:t,unitario:i},function(){}),UpdateItemTotal(n,t)};NotaFiscal.prototype.GetNumeroNotaFiscal=n=>{$.post("/ContaPrs/NotaFiscalGeraNumero",{nfid:n},function(n){return n})};NotaFiscal.prototype.GeraNumeroNotaFiscal=n=>{$.post("/ContaPrs/NotaFiscalGeraNumero",{nfid:n},function(n){if(n>0){var t=document.getElementById("NumeroNotaContainerContent");t.classList.remove("bgr");t.classList.add("nfnumgb");NotaNumero=n;document.getElementById("NumeroNf").innerText=n;document.getElementById("NumeroNfContainer").classList.remove("hidden");document.getElementById("GerarNumeroNota").classList.add("hidden");AtualizaNotaFiscalUi()}})};NotaFiscal.prototype.AtualizaNumeroNotaFiscalUI=n=>{var t=document.getElementById("NumeroNotaContainerContent");t.innerHTML=" Nº Nota Fiscal: "+n+" ";t.classList.remove("bgr");t.classList.add("nfnumgb")};UpdateItemTotal=(n,t)=>{var u="tti_"+t,f=document.getElementById("qtd_"+t).value,e=document.getElementById("uni_"+t).value.replace("R$",""),i,r;try{i=parseFloat(f);r=parseFloat(e.replace(".","").replace(",","."));i>0&&(document.getElementById(u).value=isNaN(i*r)?"":Nfmt.ToMoney(i*r));UpdateTotal()}catch(o){return console.log("erro"),!1}};UpdateTotal=()=>{var u=0,e=document.querySelectorAll("#notabody > tr > td:nth-child(2) > input"),s=document.querySelectorAll("#notabody > tr > td:nth-child(4) > input"),n,t,r,o,f;for(i=0;i<e.length;++i)n=Number(e[i].value),t=s[i].value.replace(".","").replace(".","").replace("R$ ",""),t=t.replace(",","."),r=parseFloat(t).toFixed(2),isNaN(n)||isNaN(r)||n>0&&r>0&&(u+=parseFloat(n*r));o=document.getElementById("tgeral");f=`R$ ${Nfmt.ToMoney(u).toString()}`;o.innerText=f;document.getElementById("tgeraldiv").innerText=f;TotalNota=u>0;RefreshAvailableActions()};Msg=(n,t)=>{var r=document.getElementById("msgdiv"),i;r.classList.remove("msganim");i=document.getElementById("msg");n?(i.innerText=n,i.style.color=t?t:"red"):(i.innerText="",r.style.backgroundColor="tranparent");r.classList.add("msganim")};RefreshAvailableActions=()=>{Msg(),EnderecoCompleto?AtualizaNotaFiscalUi():(Msg("Endereco esta Incompleto, campos ausentes : "+Missingfields),EscondeGerarNumeroNota(),EscondeBotaoImprimir(),EscondeNumeroNota())};PodeGerarNumero=()=>parseInt(document.getElementById("NumeroNf").innerText)===0&&TotalNota>0;PodeImprimir=()=>!PodeGerarNumero()&&TotalNota>0?!0:!1;EscondeBotaoImprimir=()=>{var n=document.getElementById("BotaoImprimir");n.classList.add("noshow")};MostraBotaoImprimir=()=>{var n=document.getElementById("BotaoImprimir");n.classList.remove("noshow")};MostraGerarNumeroNota=()=>{document.getElementById("GerarNumeroNota").classList.remove("hidden")};EscondeGerarNumeroNota=()=>{document.getElementById("GerarNumeroNota").classList.add("hidden")};MostrarNumeroNota=n=>{var t=document.getElementById("NumeroNfContainer");t.classList.remove("hidden");n?(document.getElementById("NumeroNf").style.color="black",t.classList.remove("nfnumgb"),t.classList.add("nfNumForPrint")):(document.getElementById("NumeroNf").style.color="white",t.classList.add("nfnumgb"),t.classList.remove("nfNumForPrint"))};MostrarEmissao=n=>{var t=document.getElementById("emissao");t.innerText=" DATA DE EMISSÃO : "+Hoje();t.style.color=n};EscondeNumeroNota=()=>{document.getElementById("NumeroNfContainer").classList.add("hidden")};AtualizaNotaFiscalUi=()=>{PodeGerarNumero()&&!PodeImprimir()&&(console.log("S N"),EscondeNumeroNota(),MostraGerarNumeroNota(),EscondeBotaoImprimir(),Msg("Gerar número da Nota Fiscal para habilitar impressao")),PodeGerarNumero()&&PodeImprimir()&&(console.log("S S"),EscondeNumeroNota(),MostraGerarNumeroNota(),EscondeBotaoImprimir()),PodeGerarNumero()||PodeImprimir()||(console.log("N N"),Msg("Preencher detalhes da nota para gerar Número de Nota Fiscal"),EscondeNumeroNota(),EscondeGerarNumeroNota(),EscondeBotaoImprimir()),!PodeGerarNumero()&&PodeImprimir()&&(Msg("Nota fiscal pronta para impressão","green"),MostrarNumeroNota(),EscondeGerarNumeroNota(),MostraBotaoImprimir())};Hoje=()=>{var i=new Date;let t=i.getDate(),n=i.getMonth()+1,r=i.getFullYear();return t<10&&(t="0"+t.toString()),n<10&&(n="0"+n.toString()),console.log(n),t+"/"+n+"/"+r};nfh=new NotaFiscal;